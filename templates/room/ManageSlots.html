{%extends 'base.html'%}
{%load crispy_forms_tags%}
{%block extra_head%}
    <script>
        $(document).ready(function(){
            $(".price-div").hide()
        })

        $.ajax({
            url:"{% url 'room:get_slots' room.id %}",
            dataType:'json',
            success:function(response){
                // response=JSON.parse(response)
                // for(slot in response)
                // {
                //     // console.log(response[slot])
                // }
                // render(response,0)
                console.log(response)
                }
        })
        function render(response,day){
            days=['Monday','Tuesday','Wednesday','Thrusday','Friday','Saturday','Sunday']
            days={'Monday':1,'Tuesday':2,'Wednesday':3,'Thrusday':4,'Friday':5,'Saturday':6,'Sunday':7}
            // console.log(response)
            var x=''
            for(slot in response){
                if (response[slot].fields.day==1)
                {
                    x+="<tr><td>"+response[slot].fields.price+"</td><td>"+response[slot].fields.slot+"</td><td><input name="+response[slot].fields.slot+" type=number></td></tr>"
                }
                // break
            }
            console.log(x)
            $('#price_table > tbody:last').after(x)
        }
    </script>
{%endblock%}
{%block content%}
<div class="form-group form-horizontal">
    <form id="form" style="text-align:center;width: 380px;margin: 0 auto;" method="POST">
        {%csrf_token%}
        <div id="price">
            <table border="2">
                {%for day in days%}
                <th id="{{day}}" onclick="daySelect(this,'{{day.id}}')">{{day}}</th>
                {%endfor%}
            </table>
                {%for day in days%}
                <div id="price{{day.id}}" class="price-div">
                    <table id="price_table" class="price_table"border="2">
                        <th>Slot</th>  
                        <th>Price</th>
                        {%for slot in slots%}
                                {%if slot.day == day%}
                                
                                <tr><td><input type="checkbox" name="{{slot.id}}" value="{{slot.slot}}"><br>{{slot.slot}}</td><td name='{{slot.id}}' class="pricebox {{day}} {{slot.slot}}" value='{{slot.price}}'><input type="text" style="width:50px;" class="{{day}} {{slot.slot}} {{slot.id}}" value="{{slot.price}}" readonly></td></tr>
                                {%endif%}
                        {%endfor%}
                    </table>
                </div>
                {%endfor%}
                <label for="#price">Price</label>
                <input type="number" id="price-box" name="price"><br>
                <button type="button" class="btn btn-success" id="set-slots">Set Slots</button>
                <button type="button" class="btn btn-danger" id="set-all-days">Set to all days</button>
        <!-- {{form|crispy}} -->
        <!-- {{room}} -->
        </div>
    </form>
    <script>
            function daySelect(element,id){
                console.log(id,element)
                $(".price-div").hide()
                $("#price"+id).show()
            }

            $('#set-slots').click(SetSlots)

            $('#set-all-days').click(function(){
                selected=$('input[type="checkbox"]:checked').each(function(data){

                    console.log(this.value)
                    slot=this.value

                    $(':checkbox[value="'+this.value+'"]').each(function(){
                        // console.log(this)
                    }).prop('checked',true)

                    $('table.price_table > tr > td.'+this.value+'').each(function(){
                        console.log("this")
                    })
                })
                SetSlots()
            })

            function SetSlots(){
                console.log($('#form'))
                var formdata=$('#form').serializeArray()
                $.ajax({
                    url:"{% url 'room:set-slots' room.id %}",
                    type:'POST',
                    data:formdata,
                    success: function(response){
                        console.log(response)
                        $('input[type="checkbox"]:checked').each(function(data){
                            console.log(this.value)
                            slot=this.value
                            id=this.name
                            price=$("#price-box").val()
                            $("input[type='text']").each(function(){
                            if($(this).hasClass(slot)&& $(this).hasClass(id))
                                {
                                    // console.log(this)
                                    this.value="$"+price
                                }
                            })
                            $('input[type="checkbox"]').prop('checked',false)
                        })
                    }
                })
            }
        </script>
</div>
{%endblock%}